<!doctype html>
<html>
  <head>
    <title>M1.306 - Plataformas de publicación y distribución - Práctica - Ejercicio 2</title>
	<meta http-equiv=Content-Type content="text/html; charset=utf-8">
	<link rel="stylesheet" type="text/css" href="../css/practica.css">
  </head>
  <body>
	<div class="navbar">
		<img src="../img/logouoc.png"></img>
		<a href="../index.html">Inicio</a>
		<a href="ejercicio1.html">Ejercicio 1</a>
		<a class="selected" href="">Ejercicio 2</a>
		<a href="bibliografia.html">Bibliografía</a>
	</div>
    <div class="content">
		<h1>Ejercicio 2: Práctica de streaming de un vídeo local</h1>
		
		<h2>Tarea 2.1: Codificación del vídeo</h2>

		<p>El <strong>vídeo original</strong> utilizado en este ejercicio es <strong>el mismo del ejercicio 1, "Practica_H.265.mp4",</strong> cuyas características se pueden consultar en el apartado "Tarea 1.1: Codificación de los vídeos".</p>
		
		<p>A continuación, se detallan las <strong>principales configuraciones realizadas en <i>Avidemux</i></strong> para obtener el vídeo "clip01.mkv" con el formato definido en el enunciado.</p>

		<ul>
			<li><strong>Salida de video:</strong> Mpeg4 AVC (x264).</li>
			<li><strong>Salida de audio:</strong> MP3 (lame).</li>
			<li><strong>Formato de salida:</strong> MKV Muxer.</li>
			<li><strong>Velocidad de frame:</strong> No se indica nada en el enunciado, por lo que no se ha modificado. El original es 60 fps.</li>
			<li><strong>Resolución:</strong> No se modifica, la original es 1080p.</li>
			<li><strong>Modo de codificación:</strong> Tasa de bits media (dos pasadas).</li>
			<li><strong>Tasa de bits media:</strong> 5.000 kbps.</li>
		</ul>

		<img width=650 src="../img/Ejercicio2/Tarea 2.1 - CodificaciónAvidemux.jpg">

		<p>En estas imágenes de <strong><i>MediaInfo</i></strong> se puede observar que el <strong>resultado obtenido es el indicado</strong></p>. 
	
		<img width=1000 src="../img/Ejercicio2/Tarea 2.1 - MediaInfo1.jpg">
		<img width=320 src="../img/Ejercicio2/Tarea 2.1 - MediaInfo2.jpg">
		<img width=320 src="../img/Ejercicio2/Tarea 2.1 - MediaInfo3.jpg">
		
		<diV style="display: flex;">
			<div>
				<ul><li><strong>Vídeo original:</strong> Practica_H.265.mp4</li></ul>
				<video width="600" poster="../img/VideoPoster.jpg" controls>
					<source src="../video/Practica_H.265.mp4" type="video/mp4">
				</video>
			</div>
			<div>
				<ul><li><strong>Vídeo generado:</strong> clip01.mkv</li></ul>
				<video width="600" poster="../img/VideoPoster.jpg" controls>
					<source src="../video/clip01.mkv" type="video/mp4">
				</video>
			</div>
		</diV>
		
		<h2>Tareas 2.2 y 2.3: Configuración streaming</h2>

		<h3>Configuración VLC</h3>

		<p>En las siguientes imágenes se puede observar la <strong>configuración</strong> realizada en la instancia del <strong>emisor y receptor</strong>. Como mi equipo no es muy potente, con el codec de emisión "H.264+MP3 (MP4)" la transmisión se entrecortaba, por lo que he configurado el <strong>codec de emisión "H.264+MP3 (TS)"</strong>.</p>
		
		<ul><li><strong>Emisor:</strong></li></ul>
		<img width=500 src="../img/Ejercicio2/Tarea 2.2 - Config emisor1.jpg">
		<img width=500 src="../img/Ejercicio2/Tarea 2.2 - Config emisor2.jpg">
		<img width=500 src="../img/Ejercicio2/Tarea 2.2 - Config emisor3.jpg">
		<img width=500 src="../img/Ejercicio2/Tarea 2.2 - Config emisor4.jpg">

		<p>Tal y como aparece en la última imagen, las <strong>características principales de la transcodificación</strong> que se realizará son:</p>

		<ul>
			<li><strong>Codec de vídeo:</strong> H.264</li>
			<li><strong>Codec de audio:</strong> mpga</li>
			<li><strong>Bitrate de vídeo:</strong> 800 kbps</li>
			<li><strong>Bitrate de audio:</strong> 128 kbps</li>
			<li><strong>Frecuencia de muestreo de audio:</strong> 44100 Hz</li>
		</ul>
		
		<ul><li><strong>Receptor:</strong></li></ul>
		<img width=500 src="../img/Ejercicio2/Tarea 2.2 - Config receptor.jpg">

		<h3>VLC de emisión</h3>
		<img width=1000 src="../img/Ejercicio2/Tarea 2.2 - Info emisor.jpg">

		<h3>VLC de recepción</h3>
		<img width=1000 src="../img/Ejercicio2/Tarea 2.3 - Info receptor.jpg">

		<p>Comparando la información del VLC de emisión con el de recepción, se observa que el vídeo emitido ha sido transformado antes de ser recibido. Además, comprobando los datos
			del VLC de recepción con las características de la transcodificación, se confirma que la <strong>codificación se realiza correctamente</strong>.</p>
			
		<p>Por un lado, en la pestaña de información del coded se puede ver que <strong>los codecs de audio y vídeo, el bitrate de audio y la frecuencia de muestreo de audio coinciden</strong> con la 
			transcodificación definida. Por otro lado, en la pestaña de estadísticas, se observa que el <strong>valor medio de la tasa de bits del contenido</strong> es 980 kbps, <strong>cercano a los 928 kbps (800 de vídeo + 128 de audio) definidos</strong>.</p>

		<h2>Tarea 2.4: Pausar VLC de emisión</h2>

		<p>Tras pausar el VL emisor, el vídeo del receptor tarda alrededor de <strong>3 segundos</strong> en parar. Esto se debe a varios factores.</p> 
		
		<p>Una de las razones principales es el <strong>buffer de datos del receptor</strong>. El receptor mantiene un buffer de datos para amortiguar el efecto del jitter y no pausar el vídeo en los momentos en que la llegada de datos es más lenta.
		Cuando el emisor deja de enviar datos, el receptor no parará hasta que se vacíe su buffer y no tenga más datos de reproducir.</p>

		<p>Otro factor que puede afectar son los <strong>paquetes que ya están en tránsito</strong> cuando se pausa la emisión. El receptor puede recibir paquetes enviados justo antes de pausar la emisión,
			añadirlos al buffer y reproducirlos, aumentando el tiempo.
		</p>
		
		<h2>Tarea 2.5: Compresión de vídeo emitido</h2>

		<img width=1500 src="../img/Ejercicio2/Tarea 2.5 - Emisor-Receptor.jpg">

		<p>Para el <strong>cálculo de la compresión</strong> que se está realizando se ha partido de los datos estadísticos del streaming.</p>

		<p>El <strong>tamaño del vídeo emitido</strong> se ha extraído de "Tamaño de datos del medio" de las estadísticas justo al acabar la emisión, 12.724 KiB = <strong>13.029.376 B</strong></p>

		<p>El <strong>tamaño del vídeo recibido</strong>, en cambio, al no disponer de dicha información, se ha calculado a partir de la "Tasa de bits del contenido". 
			Dicho valor varía a lo largo de la emisión, pero los 980 kbps, teniendo en cuenta los datos de la transcodificación, es una tasa razonable. 
			Como el vídeo dura 20 segundos, el tamaño del vídeo recibido es 980 kbps * 20 s = 19.600 kb -> 19.600 kb * 1.000 / 8 = <strong>2.450.000 B</strong>.</p>

		<p>Por lo tanto, el <strong>factor de compresión</strong> (original (emitido) / comprimido (recibido)) aproximado es 13.029.376 B / 2.450.000 B = <strong>5,32</strong>.</p>

		<h2>Tarea 2.6: Cloud streaming - Servicio adicional</h2>

		<p>El servicio seleccionado es <strong>el streaming de baja latencia de Amazon Interactive Video Service (IVS)</strong>.</p>

		<p>Amazon IVS es un servicio que permite, de manera sencilla, crear canales y comenzar el streaming de <strong>videos en directo de latencia baja</strong>,
			distribuyendo videos a escala en una amplia gama de dispositivos y plataformas y creando experiencias interactivas integradas en sitios web y aplicaciones.
		</p>

		<p>La <strong>entrega de contenido</strong> se puede realizar de dos <strong>formas distintas</strong>, que afectan directamente a su latencia 
			(momento en que la cámara captura una transmisión hasta que aparece en la pantalla del espectador):</p>
		<ul>
			<li><strong>Latencia baja:</strong> Mediante los canales de IVS, que entregan el vídeo con una latencia inferior a 5 segundos.</li>
			<li><strong>Latencia en tiempo real:</strong> Mediante las fases de IVS la latencia es inferior a 300ms. Si la fase se transmite a un canal, se entregará con latencia baja.</li>
		</ul>

		<p>En cualquier caso, son latencias mucho más bajas que una transmisión OTT (over-the-top) tradicional, en las que pueden llegar a ser de hasta 30 segundos.</p>

		<p>Aunque el <strong>"plano de datos" es global</strong> y las retransmisiones se pueden ver de forma global en todo el mundo, el <strong>"plano de control"
			es regional</strong>. Es decir, la consola de Amazon IVS, la API y los recursos son independientes en cada región y el usuario debe indicar donde quiere crearlos.
		</p>

		<p>Amazon IVS soporta <strong>varios protocolos de streaming</strong>:</p>
		<ul>
			<li><strong>RTMP:</strong> Real-Time Messagin Protocol, estándar para la transmisión de vídeos en la red.</li>
			<li><strong>RTMPS:</strong> La versión segura de RTMP, ejecutado sobre TLS.</li>
			<li><strong>SRT:</strong> Secure Reliable Transport, un nuevo protocolo open-source. Está diseñado para mejorar el streaming en redes poco fiables y proteger
			ante jitter, perdidas de paquetes y fluctuaciones en el ancho de banda.</li>
		</ul>

		<p>Se puede y se recomienda utilizar <strong>diferentes niveles de permisos</strong> para las distintas tareas que se pueden realizar en la plataforma:</p>
		<ul>
			<li>
				<strong>Usuario raíz:</strong> Es el usuario propio de la cuenta AWS y se crea automática al registrar una cuenta. Tiene acceso a todos los servicios y recursos de AWS.
				Se recomiendo utilizarlo solo para tareas que requieran permisos de raíz. 
			</li>
			<li>
				<strong>Usuario administrativo:</strong> Es un usuario con acceso administrativo de <i>IAM Identity Center</i> para las tareas diarias de administración.
			</li>
			<li>
				<strong>Permisos IAM:</strong> Se debe crear una política de <i>AWS Identity and Access Management (IAM)</i> o utilizar una existente para proporcionar 
				permisos básicos a los usuarios, como crear un canal en Amazon IVS, obtener información de streaming, etc.
			</li>
		</ul>

		<p>El proceso de <strong>implementación</strong> de un streaming básico en IVS consta de los siguientes <strong>pasos principales</strong>:</p>
		<ol>
			<li>
				<strong>Crear una cuenta de AWS:</strong> 
				Es necesario crear una cuenta nueva o utilizar una cuenta existente, pero debe estar en una región de AWS compatible con Amazon IVS.
			</li>
			<li>
				<strong>Configurar usuarios:</strong>
				Tal y como se ha indicado anteriormente, hay que configurar el usuario raíz, el usuario administrativo y los permisos de IAM para una correcta gestión de usuarios y permisos.
			</li>
			<li>
				<strong>Crear un canal:</strong>
				Un canal almacena información de la configuración relacionada con la transmisión en directo. Se definen los siguientes elementos:
				<ul>
					<li><strong>Servidor de incorporación:</strong> Componente específico de Amazon IVS que recibe la transmisión, junto con un protocolo de incorporación RTMPS o RTMP.</li>
					<li><strong>Clave de transmisión:</strong> Se trata de una clave que se genera al crear el canal y se utiliza para autorizar el streaming en él.</li>
					<li><strong>URL de reproducción:</strong> URL de acceso a la reproducción del canal. Amazon IVS selecciona automáticamente la mejor ubicación de la red global para la entrega del contenido.</li>
				</ul>
			</li>

			<li>
				<strong>Configurar el software de streaming:</strong>
				Se puede configurar el stream de tres maneras:
				<ul>
					<li><strong>SDK nativo de emisión:</strong> Soporta RTMPS y es el recomendado para entornos productivos. Existen SDKs para desarrollar aplicaciones en 
					Android y iOS, y un SDK para aplicaciones web utilizando WebRTC.</li>
					<li><strong>Consola de Amazon IVS:</strong> Desde la <a target="_blank" href="https://console.aws.amazon.com/ivs">consola de Amazon IVS</a> se puede iniciar
					un stream de manera sencilla permitiendo a la consola acceder a la cámara y micrófono del dispositivo. Consume recursos, por lo que puede incurrir en gastos.
					Está pensado para testing.</li>
					<li><strong>Otros software y codificadores de streaming:</strong> Se pueden utilizar otros codificadores mientras soporten los protocolos RTMP, RTMPS o SRT.
					Por ejemplo, streaming con "OBS Studio" utilizando RTMPS o SRT o envío de videos grabado con "FFmpeg" utilizando RTMPS o SRT. En cualquier caso, es necesario
					configurar, entre otros parámetros, la clave de transmisión, la resolución de salida y el bitrate.
					</li>
				</ul>
			</li>
			<li>
				<strong>Visualizar la transmisión:</strong>
				La visualización se puede realizar de dos maneras:
				<ul>
					<li><strong>SDK nativo de reproducción:</strong> Utilizando el SDK y la URL de reproducción, se configuran reproductores que optimizados para latencias bajas.</li>
					<li><strong>Consola de Amazon IVS:</strong> Desde la consola se puede seleccionar el canal que se quiere ver, pero puede incurrir en gastos.</li>
				</ul>
			</li>
		</ol>
		
		<p>Los <strong>costes</strong> del servicio Amazon IVS están definidos <strong>por hora</strong>. El <strong>costo de entrada de vídeo</strong> depende del tipo de canal/calidad. 
			El de <strong>salida</strong>, en cambio, es en función de la ubicación de los servidores a los que se conectan los espectadores y por niveles de uso.</p>
		
			<table>
				<tr>
					<td><p><strong>Costo de entrada de vídeo</strong></p></td>
					<td><p><strong>Costo de salida de vídeo</strong></p></td>
				</tr>
				<tr>
					<td><img width=600 src="../img/Ejercicio2/Tarea 2.6 - CosteEntradaVideo.jpg"></td>
					<td><img width=600 src="../img/Ejercicio2/Tarea 2.6 - CosteSalidaVideo.jpg"></td>
				</tr>
			</table>
		
		<p>Para el <strong>cálculo del coste</strong> por minuto de una transmisión de un stream HD en directo por 10.000 usuarios simultáneos se asumirá que todos los espectadores se conectan desde 
			Europa, y que el nivel de uso es el primero (primeras 10.000 horas).</p>

		<ul>
			<li><strong>Entrada de video en HD:</strong> 0,85 USD/h</li>
			<li><strong>Salida de video en directo en HD en Europa:</strong> 0,0720 USD/h * 10.000 espectadores = 720 USD</li>
			<li><strong>TOTAL: 720,85 USD/h = 12,01416 USD/min</strong></li>
		</ul>

    </div>
    <div class="footer">
		<div class="left">
			<span>M1.306 - Plataformas de publicación y distribución<br>Práctica</span>
		</div>
		<div class="right">
			<span>Gorriti Azkue, David<br>26/05/2025</span>
		</div>
    </div>
  </body>
</html>